// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: stats.sql

package sqlcdb

import (
	"context"
)

const getOverallStats = `-- name: GetOverallStats :one
SELECT
    (SELECT count(*)::int FROM systems WHERE deleted_at IS NULL) AS systems,
    (SELECT count(*)::int FROM talkgroups) AS talkgroups,
    (SELECT count(*)::int FROM units) AS units,
    (SELECT count(*)::int FROM calls) AS total_calls,
    (SELECT count(*)::int FROM calls WHERE start_time > now() - interval '30 days') AS calls_30d,
    (SELECT count(*)::int FROM calls WHERE start_time > now() - interval '24 hours') AS calls_24h,
    (SELECT count(*)::int FROM calls WHERE start_time > now() - interval '1 hour') AS calls_1h,
    COALESCE((SELECT sum(duration) / 3600.0 FROM calls WHERE duration IS NOT NULL), 0)::float8 AS total_duration_hours
`

type GetOverallStatsRow struct {
	Systems            int
	Talkgroups         int
	Units              int
	TotalCalls         int
	Calls30d           int
	Calls24h           int
	Calls1h            int
	TotalDurationHours float64
}

func (q *Queries) GetOverallStats(ctx context.Context) (GetOverallStatsRow, error) {
	row := q.db.QueryRow(ctx, getOverallStats)
	var i GetOverallStatsRow
	err := row.Scan(
		&i.Systems,
		&i.Talkgroups,
		&i.Units,
		&i.TotalCalls,
		&i.Calls30d,
		&i.Calls24h,
		&i.Calls1h,
		&i.TotalDurationHours,
	)
	return i, err
}

const getSystemActivity = `-- name: GetSystemActivity :many
SELECT
    s.system_id, COALESCE(s.name, '') AS system_name, s.sysid,
    (SELECT count(*)::int FROM calls c WHERE c.system_id = s.system_id AND c.start_time > now() - interval '1 hour') AS calls_1h,
    (SELECT count(*)::int FROM calls c WHERE c.system_id = s.system_id AND c.start_time > now() - interval '24 hours') AS calls_24h,
    (SELECT count(DISTINCT tgid)::int FROM calls c WHERE c.system_id = s.system_id AND c.start_time > now() - interval '1 hour') AS active_talkgroups,
    (SELECT COALESCE(sum(t.unit_count_30d), 0)::int FROM talkgroups t
        WHERE t.system_id = s.system_id) AS active_units
FROM systems s
WHERE s.deleted_at IS NULL
ORDER BY s.system_id
`

type GetSystemActivityRow struct {
	SystemID         int
	SystemName       string
	Sysid            string
	Calls1h          int
	Calls24h         int
	ActiveTalkgroups int
	ActiveUnits      int
}

func (q *Queries) GetSystemActivity(ctx context.Context) ([]GetSystemActivityRow, error) {
	rows, err := q.db.Query(ctx, getSystemActivity)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetSystemActivityRow{}
	for rows.Next() {
		var i GetSystemActivityRow
		if err := rows.Scan(
			&i.SystemID,
			&i.SystemName,
			&i.Sysid,
			&i.Calls1h,
			&i.Calls24h,
			&i.ActiveTalkgroups,
			&i.ActiveUnits,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listP25Systems = `-- name: ListP25Systems :many
SELECT s.system_id, COALESCE(s.name, '') AS name, s.sysid, s.wacn,
    (SELECT count(*)::int FROM talkgroups t WHERE t.system_id = s.system_id) AS talkgroup_count,
    (SELECT count(*)::int FROM units u WHERE u.system_id = s.system_id) AS unit_count,
    (SELECT count(*)::int FROM calls c WHERE c.system_id = s.system_id AND c.start_time > now() - interval '24 hours') AS calls_24h
FROM systems s
WHERE s.system_type IN ('p25', 'smartnet') AND s.deleted_at IS NULL
ORDER BY s.system_id
`

type ListP25SystemsRow struct {
	SystemID       int
	Name           string
	Sysid          string
	Wacn           string
	TalkgroupCount int
	UnitCount      int
	Calls24h       int
}

func (q *Queries) ListP25Systems(ctx context.Context) ([]ListP25SystemsRow, error) {
	rows, err := q.db.Query(ctx, listP25Systems)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListP25SystemsRow{}
	for rows.Next() {
		var i ListP25SystemsRow
		if err := rows.Scan(
			&i.SystemID,
			&i.Name,
			&i.Sysid,
			&i.Wacn,
			&i.TalkgroupCount,
			&i.UnitCount,
			&i.Calls24h,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
