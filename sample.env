# tr-engine configuration
# Copy this file to .env and fill in your values.
# .env is gitignored and auto-loaded on startup.

# =============================================================================
# Required
# =============================================================================

# PostgreSQL connection URL
DATABASE_URL=postgres://user:password@localhost:5432/trengine?sslmode=disable

# MQTT broker URL
MQTT_BROKER_URL=tcp://localhost:1883

# =============================================================================
# MQTT (optional)
# =============================================================================

# MQTT client ID (must be unique per connection)
MQTT_CLIENT_ID=tr-engine

# MQTT topic filter. Comma-separated list of MQTT topic patterns.
# Default "#" subscribes to everything (fine for dedicated brokers).
# To limit, use the prefixes from your trunk-recorder MQTT plugin config:
#   MQTT_TOPICS=myprefix/feeds/#,myprefix/units/#,myprefix/messages/#
MQTT_TOPICS=#

# MQTT credentials (leave empty if broker allows anonymous)
MQTT_USERNAME=
MQTT_PASSWORD=

# =============================================================================
# HTTP Server (optional)
# =============================================================================

# Listen address (host:port)
HTTP_ADDR=:8080

# Request timeouts
HTTP_READ_TIMEOUT=5s
HTTP_WRITE_TIMEOUT=30s
HTTP_IDLE_TIMEOUT=120s

# Bearer token for API authentication (empty = no auth required)
AUTH_TOKEN=

# =============================================================================
# Application (optional)
# =============================================================================

# Directory for storing audio files (used when audio is received via MQTT)
AUDIO_DIR=./audio

# trunk-recorder audio directory (optional). When set, tr-engine can serve
# audio files directly from TR's filesystem using the call_filename stored at
# call_end. This is an alternative to receiving base64-encoded audio over MQTT.
# Point this at TR's audioBaseDir (or a mount of it).
# TR_AUDIO_DIR=/app/tr_audio

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Raw MQTT message archival. Messages are always processed by handlers regardless
# of these settings â€” this only controls storage in mqtt_raw_messages.
#
# Master switch: set to false to disable all raw archival.
RAW_STORE=true
#
# Allowlist mode (comma-separated handler names). When set, ONLY these handlers
# are archived. Use "_unknown" to capture unrecognized/malformed messages.
# Takes priority over RAW_EXCLUDE_TOPICS.
# RAW_INCLUDE_TOPICS=_unknown,call_start,call_end,audio
#
# Denylist mode (comma-separated handler names). Ignored if RAW_INCLUDE_TOPICS is set.
# Valid handler names: trunking_message, unit_event, console, recorders, rates,
#   call_start, call_end, calls_active, audio, config, status, systems, system, recorder
# RAW_EXCLUDE_TOPICS=trunking_message
